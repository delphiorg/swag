<html>
<head><title> "Lineplay Screen Saver" by MARIO VAN DEN ANCKER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center">
<b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0080.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0080.LINEPLAY.ZIP">Attachment</a><b>]</b>

</p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Program </b></font>LinePlayScreensaver<font color="#000080">;

</font><font color="#008000"><i>{ LinePlay.pas - by Mario van den Ancker
                 E-Mail: mario@astro.uva.nl
                 WWW: http://www.astro.uva.nl/mario/
  Windows 3.x screen saver in TPW. Fully configurable via control panel and
  with password support. Requires saver.pas and lineplay.res, included below.
  lineplay.res is encoded with xx3402. Compile this program, copy the .exe
  file to your windows directory with the extension .scr, and the screen
  saver will show up in the desktop section of control panel.
  Donated to the public domain 11/95. }

</i></font><font color="#FF0000"><b>uses </b></font>Wintypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>WObjects<font color="#000080">, </font>Strings<font color="#000080">, </font>Saver<font color="#000080">;

</font><font color="#008000"><i>{$D SCRNSAVE Line Play}     { This is the name that will show up in control panel. }
{$R LinePlay.Res}

</i></font><font color="#FF0000"><b>const
  </b></font>cm_About         <font color="#000080">= </font><font color="#800000">103</font><font color="#000080">;
  </font>cm_SetPassword   <font color="#000080">= </font><font color="#800000">105</font><font color="#000080">;

  </font>id_Color         <font color="#000080">= </font><font color="#800000">107</font><font color="#000080">;
  </font>id_PWProtected   <font color="#000080">= </font><font color="#800000">104</font><font color="#000080">;
  </font>id_RadioColFixed <font color="#000080">= </font><font color="#800000">121</font><font color="#000080">;
  </font>id_RadioColRnd   <font color="#000080">= </font><font color="#800000">122</font><font color="#000080">;
  </font>id_NumLines      <font color="#000080">= </font><font color="#800000">101</font><font color="#000080">;
  </font>id_TimerInterval <font color="#000080">= </font><font color="#800000">120</font><font color="#000080">;

  </font>White        <font color="#000080">= </font><font color="#800000">$00FFFFFF</font><font color="#000080">;
  </font>Black        <font color="#000080">= </font><font color="#800000">$00000000</font><font color="#000080">;
  </font>LightGray    <font color="#000080">= </font><font color="#800000">$00C0C0C0</font><font color="#000080">;
  </font>DarkGray     <font color="#000080">= </font><font color="#800000">$00808080</font><font color="#000080">;
  </font>Cyan         <font color="#000080">= </font><font color="#800000">$00FFFF00</font><font color="#000080">;
  </font>Magenta      <font color="#000080">= </font><font color="#800000">$00FF00FF</font><font color="#000080">;
  </font>Yellow       <font color="#000080">= </font><font color="#800000">$0000FFFF</font><font color="#000080">;
  </font>Red          <font color="#000080">= </font><font color="#800000">$000000FF</font><font color="#000080">;
  </font>Green        <font color="#000080">= </font><font color="#800000">$0000FF00</font><font color="#000080">;
  </font>Blue         <font color="#000080">= </font><font color="#800000">$00FF0000</font><font color="#000080">;
  </font>LightBlue    <font color="#000080">= </font><font color="#800000">$00800000</font><font color="#000080">;
  </font>LightCyan    <font color="#000080">= </font><font color="#800000">$00808000</font><font color="#000080">;
  </font>LightMagenta <font color="#000080">= </font><font color="#800000">$00800080</font><font color="#000080">;
  </font>Brown        <font color="#000080">= </font><font color="#800000">$00008080</font><font color="#000080">;
  </font>LightRed     <font color="#000080">= </font><font color="#800000">$00000080</font><font color="#000080">;
  </font>LightGreen   <font color="#000080">= </font><font color="#800000">$00008000</font><font color="#000080">;
  </font>NColors <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
  </font>StdColors <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NColors<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TColorRef <font color="#000080">=
   (</font>White<font color="#000080">, </font>Black<font color="#000080">, </font>LightGray<font color="#000080">, </font>DarkGray<font color="#000080">, </font>Cyan<font color="#000080">, </font>Magenta<font color="#000080">, </font>Yellow<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">,
    </font>Blue<font color="#000080">, </font>LightBlue<font color="#000080">, </font>LightCyan<font color="#000080">, </font>LightMagenta<font color="#000080">, </font>Brown<font color="#000080">, </font>LightRed<font color="#000080">, </font>LightGreen<font color="#000080">);

  </font>MaxLines <font color="#000080">= </font><font color="#800000">25</font><font color="#000080">;      </font><font color="#008000"><i>{ Maximum number of bouncing lines }
  </i></font>id_Timer <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;


</font><font color="#FF0000"><b>type
  </b></font>TSaveApplication <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TApplication<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>InitMainWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Create TConfigDialog, a TDlgWindow descendant. }
  </i></font>PSetPasswordDialog <font color="#000080">= ^</font>TSetPasswordDialog<font color="#000080">;
  </font>TSetPasswordDialog <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TDlgWindow<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>id_Ok<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Create TConfigDialog, a TDialog descendant. }
  </i></font>PConfigDialog <font color="#000080">= ^</font>TConfigDialog<font color="#000080">;
  </font>TConfigDialog <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TDlgWindow<font color="#000080">)
    </font>NumLines<font color="#000080">, </font>TimerInterval<font color="#000080">: </font>Integer<font color="#000080">;
    </font>Color<font color="#000080">: </font>TColorRef<font color="#000080">;
    </font>PWProtected<font color="#000080">, </font>RndColor<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Password<font color="#000080">: </font>TPasswordString<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetupWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>cmAbout<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>Tmessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>cm_About<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>cmSetPassword<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>Tmessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>cm_SetPassword<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>wmDrawItem<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg <font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>wm_First <font color="#000080">+ </font>wm_DrawItem<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>wmMeasureItem<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg <font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>wm_First <font color="#000080">+ </font>wm_MeasureItem<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>id_Ok<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Create TSaveWindow, a TScrSavWindow descendant. }
  </i></font>PSaveWindow <font color="#000080">= ^</font>TSaveWindow<font color="#000080">;
  </font>TSaveWindow <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TScrnSavWindow<font color="#000080">)
    </font>PosX<font color="#000080">, </font>PosY<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxLines<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
    </font>VelX<font color="#000080">, </font>VelY<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
    </font>NumLines<font color="#000080">, </font>TimerInterval<font color="#000080">: </font>Integer<font color="#000080">;
    </font>Color<font color="#000080">: </font>TColorRef<font color="#000080">;
    </font>RndColor<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>MaxX<font color="#000080">, </font>MaxY<font color="#000080">, </font>MidX<font color="#000080">, </font>MidY<font color="#000080">: </font>Integer<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>aParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">: </font>PChar<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>SetupWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>wmTimer<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>wm_First <font color="#000080">+ </font>wm_Timer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>GetPrivateProfileLongInt<font color="#000080">(</font>AppName<font color="#000080">, </font>KeyName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>Default</b></font><font color="#000080">: </font>LongInt<font color="#000080">; </font>FileName<font color="#000080">: 
</font>PChar<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Str1<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>ScrLongInt<font color="#000080">: </font>LongInt<font color="#000080">;
  </font>ErrCode<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetPrivateProfileString<font color="#000080">(</font>AppName<font color="#000080">, </font>KeyName<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font>Str1<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Str1<font color="#000080">), </font>FileName<font color="#000080">);
  </font>Val<font color="#000080">(</font>Str1<font color="#000080">, </font>ScrLongInt<font color="#000080">, </font>ErrCode<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ErrCode <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ScrlongInt <font color="#000080">:= </font><font color="#FF0000"><b>Default</b></font><font color="#000080">;
  </font>GetPrivateProfileLongInt <font color="#000080">:= </font>ScrLongInt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ --------TSaveApplication methods------------------ }
</i></font><font color="#FF0000"><b>procedure </b></font>TSaveApplication<font color="#000080">.</font>InitMainWindow<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font><font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">'/c'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">'-c'</font><font color="#000080">) </font><font color="#FF0000"><b>then
   </b></font>MainWindow<font color="#000080">:= </font>New<font color="#000080">(</font>PSaveWindow<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'ScreenSaver'</font><font color="#000080">))
 </font><font color="#FF0000"><b>else
   </b></font>MainWindow <font color="#000080">:= </font>New<font color="#000080">(</font>PConfigDialog<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">, </font><font color="#800000">'SETUP'</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TSaveApplication<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TApplication<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ --------TConfigDialog methods------------------ }
</i></font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>wmDrawItem<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Brush<font color="#000080">: </font>HBrush<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>PDrawItemStruct<font color="#000080">(</font>Msg<font color="#000080">.</font>lParam<font color="#000080">)^ </font><font color="#FF0000"><b>do
  begin
    if </b></font><font color="#000080">(</font>CtlType <font color="#000080">= </font>odt_ComboBox<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      if </b></font><font color="#000080">((</font>ItemAction <font color="#FF0000"><b>and </b></font>oda_DrawEntire<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">((</font>ItemAction <font color="#FF0000"><b>and </b></font>oda_Select<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>Brush <font color="#000080">:= </font>CreateSolidBrush<font color="#000080">(</font>ItemData<font color="#000080">);
        </font>FillRect<font color="#000080">(</font>hDC<font color="#000080">, </font>rcItem<font color="#000080">, </font>Brush<font color="#000080">);
        </font>DeleteObject<font color="#000080">(</font>Brush<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>ItemState <font color="#FF0000"><b>and </b></font>ods_Focus<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">((</font>ItemState <font color="#FF0000"><b>and </b></font>ods_Selected<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>InflateRect<font color="#000080">(</font>rcItem<font color="#000080">, -</font><font color="#800000">2</font><font color="#000080">, -</font><font color="#800000">2</font><font color="#000080">);
        </font>DrawFocusRect<font color="#000080">(</font>hDC<font color="#000080">, </font>rcItem<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>wmMeasureItem<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>PMeasureItemStruct<font color="#000080">(</font>Msg<font color="#000080">.</font>lParam<font color="#000080">)^.</font>ItemHeight <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>SetupWindow<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetupColors<font color="#000080">(</font>ID<font color="#000080">: </font>Integer<font color="#000080">; </font>Color<font color="#000080">: </font>TColorRef<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>Sel<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Sel <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NColors <font color="#FF0000"><b>do
  begin
    </b></font>SendDlgItemMsg<font color="#000080">(</font>ID<font color="#000080">, </font>cb_AddString<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>StdColors<font color="#000080">[</font>i<font color="#000080">]);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StdColors<font color="#000080">[</font>i<font color="#000080">] = </font>Color<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Sel <font color="#000080">:= </font>pred<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Sel <font color="#000080">= -</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>SendDlgItemMsg<font color="#000080">(</font>ID<font color="#000080">, </font>cb_AddString<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Color<font color="#000080">);
    </font>Sel <font color="#000080">:= </font>NColors<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SendDlgItemMsg<font color="#000080">(</font>ID<font color="#000080">, </font>cb_SetCurSel<font color="#000080">, </font>Sel<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>TDlgWindow<font color="#000080">.</font>SetUpWindow<font color="#000080">;

  </font>NumLines <font color="#000080">:= </font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Number of Lines'</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>Color <font color="#000080">:= </font>GetPrivateProfileLongInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Drawing Color'</font><font color="#000080">, </font>Cyan<font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>RndColor <font color="#000080">:= (</font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Random Color'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'CONTROL.INI'</font><font color="#000080">) 
= </font><font color="#800000">1</font><font color="#000080">);
  </font>TimerInterval <font color="#000080">:= </font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Timer Interval'</font><font color="#000080">, </font><font color="#800000">30</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>PWProtected <font color="#000080">:= (</font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'PWProtected'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);
  </font>GetPrivateProfileString<font color="#000080">(</font><font color="#800000">'ScreenSaver'</font><font color="#000080">, </font><font color="#800000">'Password'</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font>Password<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Password<font color="#000080">), 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);

  </font>SetDlgItemInt<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_NumLines<font color="#000080">, </font>NumLines<font color="#000080">, </font>True<font color="#000080">);
  </font>SetupColors<font color="#000080">(</font>id_Color<font color="#000080">, </font>Color<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RndColor <font color="#FF0000"><b>then
    </b></font>CheckRadioButton<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_RadioColFixed<font color="#000080">, </font>id_RadioColRnd<font color="#000080">, </font>id_RadioColRnd<font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>CheckRadioButton<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_RadioColFixed<font color="#000080">, </font>id_RadioColRnd<font color="#000080">, </font>id_RadioColFixed<font color="#000080">);
  </font>SetDlgItemInt<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_TimerInterval<font color="#000080">, </font>TimerInterval<font color="#000080">, </font>True<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>PWProtected <font color="#FF0000"><b>then
    </b></font>CheckDlgButton<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWProtected<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>CheckDlgButton<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWProtected<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Respond to pressing About button. }
</i></font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>cmAbout<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Application<font color="#000080">^.</font>ExecDialog<font color="#000080">(</font>new<font color="#000080">(</font>PDialog<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font><font color="#800000">'ABOUT'</font><font color="#000080">)));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Respond to pressing Set Password button. }
</i></font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>cmSetPassword<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Password<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Application<font color="#000080">^.</font>ExecDialog<font color="#000080">(</font>new<font color="#000080">(</font>PSetPasswordDialog<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font><font color="#800000">'CHPWD2'</font><font color="#000080">)))
  </font><font color="#FF0000"><b>else
    </b></font>Application<font color="#000080">^.</font>ExecDialog<font color="#000080">(</font>new<font color="#000080">(</font>PSetPasswordDialog<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font><font color="#800000">'CHPWD'</font><font color="#000080">)));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Gets an integer value from a input dialog. If the input text
  is not a number or the input number is outside a specified range
  it puts up an errorbox and return false for NoErrors. InputNr is
  not changed when an error has occured. }
</i></font><font color="#FF0000"><b>procedure </b></font>GetDlgInt<font color="#000080">(</font>HWindow<font color="#000080">: </font>HWnd<font color="#000080">; </font>ThisID<font color="#000080">: </font>Integer<font color="#000080">; </font>MinVal<font color="#000080">, </font>MaxVal<font color="#000080">: </font>Integer<font color="#000080">;
                    </font><font color="#FF0000"><b>var </b></font>InputNr<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>NoErrors<font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Str1<font color="#000080">, </font>Str2<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>CS<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>ErrCode<font color="#000080">, </font>ScrInt<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetDlgItemText<font color="#000080">(</font>HWindow<font color="#000080">, </font>ThisID<font color="#000080">, </font>CS<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CS<font color="#000080">));
  </font>Val<font color="#000080">(</font>CS<font color="#000080">, </font>ScrInt<font color="#000080">, </font>ErrCode<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ErrCode <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>NoErrors <font color="#000080">:= </font>False<font color="#000080">;
    </font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'Please input numbers only!'</font><font color="#000080">, </font><font color="#800000">'Error'</font><font color="#000080">, </font>mb_Ok <font color="#FF0000"><b>or 
</b></font>mb_IconExclamation<font color="#000080">);
    </font>SetFocus<font color="#000080">(</font>GetDlgItem<font color="#000080">(</font>HWindow<font color="#000080">, </font>ThisID<font color="#000080">));
    </font>SendDlgItemMessage<font color="#000080">(</font>HWindow<font color="#000080">, </font>ThisID<font color="#000080">, </font>em_SetSel<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>MakeLong<font color="#000080">(</font><font color="#800000">32767</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
  </font><font color="#FF0000"><b>end
  else
  begin
    if </b></font><font color="#000080">(</font>ScrInt <font color="#000080">&lt; </font>MinVal<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ScrInt <font color="#000080">&gt; </font>MaxVal<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>NoErrors <font color="#000080">:= </font>False<font color="#000080">;
      </font>Str<font color="#000080">(</font>MinVal<font color="#000080">, </font>Str1<font color="#000080">);
      </font>Str<font color="#000080">(</font>MaxVal<font color="#000080">, </font>Str2<font color="#000080">);
      </font>StrCopy<font color="#000080">(</font>CS<font color="#000080">, </font><font color="#800000">'Number must be in the range '</font><font color="#000080">);
      </font>StrCat<font color="#000080">(</font>CS<font color="#000080">, </font>Str1<font color="#000080">);
      </font>StrCat<font color="#000080">(</font>CS<font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">);
      </font>StrCat<font color="#000080">(</font>CS<font color="#000080">, </font>Str2<font color="#000080">);
      </font>StrCat<font color="#000080">(</font>CS<font color="#000080">, </font><font color="#800000">'!'</font><font color="#000080">);
      </font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font>CS<font color="#000080">, </font><font color="#800000">'Error'</font><font color="#000080">, </font>mb_Ok <font color="#FF0000"><b>or </b></font>mb_IconExclamation<font color="#000080">);
      </font>SetFocus<font color="#000080">(</font>GetDlgItem<font color="#000080">(</font>HWindow<font color="#000080">, </font>ThisID<font color="#000080">));
      </font>SendDlgItemMessage<font color="#000080">(</font>HWindow<font color="#000080">, </font>ThisID<font color="#000080">, </font>em_SetSel<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>MakeLong<font color="#000080">(</font><font color="#800000">32767</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
    </font><font color="#FF0000"><b>end
    else
      </b></font>InputNr <font color="#000080">:= </font>ScrInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Respond to pressing Ok button. }
</i></font><font color="#FF0000"><b>procedure </b></font>TConfigDialog<font color="#000080">.</font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>NoErrors<font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetCol<font color="#000080">(</font>ID<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Color<font color="#000080">: </font>TColorRef<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Sel<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Sel <font color="#000080">:= </font>SendDlgItemMsg<font color="#000080">(</font>ID<font color="#000080">, </font>cb_GetCurSel<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Sel <font color="#000080">&gt; -</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>SendDlgItemMsg<font color="#000080">(</font>ID<font color="#000080">, </font>cb_GetLBText<font color="#000080">, </font>Sel<font color="#000080">, </font>TColorRef<font color="#000080">(@</font>Color<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WritePrivateProfileInt<font color="#000080">(</font>Str1<font color="#000080">: </font>PChar<font color="#000080">; </font>ThisInt<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Str2<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>ThisInt<font color="#000080">, </font>Str2<font color="#000080">);
  </font>WritePrivateProfileString<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font>Str1<font color="#000080">, </font>Str2<font color="#000080">, </font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>NoErrors <font color="#000080">:= </font>True<font color="#000080">;
  </font>GetDlgInt<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_NumLines<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>MaxLines<font color="#000080">, </font>NumLines<font color="#000080">, </font>NoErrors<font color="#000080">);
  </font>GetCol<font color="#000080">(</font>id_Color<font color="#000080">, </font>Color<font color="#000080">);
  </font>RndColor <font color="#000080">:= (</font>IsDlgButtonChecked<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_RadioColRnd<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>NoErrors <font color="#FF0000"><b>then </b></font>GetDlgInt<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_TimerInterval<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">500</font><font color="#000080">, </font>TimerInterval<font color="#000080">, </font>NoErrors<font color="#000080">);
  </font>PWProtected <font color="#000080">:= (</font>IsDlgButtonChecked<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWProtected<font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#FF0000"><b>if </b></font>NoErrors <font color="#FF0000"><b>then
  begin
    </b></font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'Number of Lines'</font><font color="#000080">, </font>NumLines<font color="#000080">);
    </font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'Drawing Color'</font><font color="#000080">, </font>Color<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>RndColor <font color="#FF0000"><b>then
      </b></font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'Random Color'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'Random Color'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'Timer Interval'</font><font color="#000080">, </font>TimerInterval<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>PWProtected <font color="#FF0000"><b>then
      </b></font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'PWProtected'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>WritePrivateProfileInt<font color="#000080">(</font><font color="#800000">'PWProtected'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font>WritePrivateProfileString<font color="#000080">(</font><font color="#800000">'ScreenSaver'</font><font color="#000080">, </font><font color="#800000">'Password'</font><font color="#000080">, </font>Password<font color="#000080">, </font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
    </font>TDlgWindow<font color="#000080">.</font>Ok<font color="#000080">(</font>Msg<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{ --------TSetPasswordDialog methods------------------ }
{ Respond to pressing Ok button. }
</i></font><font color="#FF0000"><b>procedure </b></font>TSetPasswordDialog<font color="#000080">.</font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>id_PWoldPW   <font color="#000080">= </font><font color="#800000">104</font><font color="#000080">;
  </font>id_PWnewPW   <font color="#000080">= </font><font color="#800000">105</font><font color="#000080">;
  </font>id_PWnewPW2  <font color="#000080">= </font><font color="#800000">106</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NoErrors<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>OldPW<font color="#000080">, </font>PWStr1<font color="#000080">, </font>PWStr2<font color="#000080">: </font>TPasswordString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NoErrors <font color="#000080">:= </font>True<font color="#000080">;
  </font>GetDlgItemText<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWoldPW<font color="#000080">, </font>OldPW<font color="#000080">, </font>SizeOf<font color="#000080">(</font>OldPW<font color="#000080">));
  </font>PWEncode<font color="#000080">(</font>OldPW<font color="#000080">);
  </font>GetDlgItemText<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWnewPW<font color="#000080">, </font>PWStr1<font color="#000080">, </font>SizeOf<font color="#000080">(</font>PWStr1<font color="#000080">));
  </font>GetDlgItemText<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWnewPW2<font color="#000080">, </font>PWStr2<font color="#000080">, </font>SizeOf<font color="#000080">(</font>PWStr2<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StrIComp<font color="#000080">(</font>PWStr1<font color="#000080">, </font>PWStr2<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'The values for New Password and Retype New Password do not 
</font>match<font color="#000080">.</font><font color="#800000">' +
               #13 </font><font color="#000080">+ </font><font color="#800000">'Please try again.'</font><font color="#000080">, </font><font color="#800000">'Change Password'</font><font color="#000080">, </font>mb_Ok <font color="#FF0000"><b>or </b></font>mb_IconStop<font color="#000080">);
    </font>SetFocus<font color="#000080">(</font>GetDlgItem<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWOldPW<font color="#000080">));
    </font>NoErrors <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>NoErrors <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>PConfigDialog<font color="#000080">(</font>Parent<font color="#000080">)^.</font>PassWord<font color="#000080">, </font>OldPW<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'The value for Old Password is not correct.' </font><font color="#000080">+ </font><font color="#800000">#13 </font><font color="#000080">+
               </font><font color="#800000">'Please check your screen saver password and try again.'</font><font color="#000080">,
               </font><font color="#800000">'Change Password'</font><font color="#000080">, </font>mb_Ok <font color="#FF0000"><b>or </b></font>mb_IconStop<font color="#000080">);
    </font>SetFocus<font color="#000080">(</font>GetDlgItem<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_PWNewPW<font color="#000080">));
    </font>NoErrors <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>NoErrors <font color="#FF0000"><b>then
  begin
    </b></font>PWEncode<font color="#000080">(</font>PWStr1<font color="#000080">);
    </font>StrCopy<font color="#000080">(</font>PConfigDialog<font color="#000080">(</font>Parent<font color="#000080">)^.</font>PassWord<font color="#000080">, </font>PWStr1<font color="#000080">);
    </font>TDlgWindow<font color="#000080">.</font>Ok<font color="#000080">(</font>Msg<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ --------TSaveWindow methods------------------ }
</i></font><font color="#FF0000"><b>constructor </b></font>TSaveWindow<font color="#000080">.</font>Init<font color="#000080">(</font>aParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>DC<font color="#000080">: </font>HDC<font color="#000080">;
  </font>i<font color="#000080">, </font>j<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TScrnSavWindow<font color="#000080">.</font>Init<font color="#000080">(</font>aParent<font color="#000080">, </font>aTitle<font color="#000080">);
  </font>NumLines <font color="#000080">:= </font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Number of Lines'</font><font color="#000080">, </font><font color="#800000">10</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>Color <font color="#000080">:= </font>GetPrivateProfileLongInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Drawing Color'</font><font color="#000080">, </font>Cyan<font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>RndColor <font color="#000080">:= (</font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Random Color'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'CONTROL.INI'</font><font color="#000080">) 
= </font><font color="#800000">1</font><font color="#000080">);
  </font>TimerInterval <font color="#000080">:= </font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'Timer Interval'</font><font color="#000080">, </font><font color="#800000">30</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);
  </font>PWProtected <font color="#000080">:= (</font>GetPrivateProfileInt<font color="#000080">(</font><font color="#800000">'Screen Saver.Line Play'</font><font color="#000080">, </font><font color="#800000">'PWProtected'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">);
  </font>GetPrivateProfileString<font color="#000080">(</font><font color="#800000">'ScreenSaver'</font><font color="#000080">, </font><font color="#800000">'Password'</font><font color="#000080">, </font><font color="#800000">''</font><font color="#000080">, </font>Password<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Password<font color="#000080">), 
</font><font color="#800000">'CONTROL.INI'</font><font color="#000080">);

  </font>Randomize<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>RndColor <font color="#FF0000"><b>then
    Repeat
      </b></font>Color <font color="#000080">:= </font>StdColors<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">+</font>Random<font color="#000080">(</font>NColors<font color="#000080">)];
    </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Color <font color="#000080">&lt;&gt; </font>Black<font color="#000080">);

  </font>DC <font color="#000080">:= </font>GetWindowDC<font color="#000080">(</font>HWindow<font color="#000080">);
  </font>MaxX <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>DC<font color="#000080">, </font>HorzRes<font color="#000080">);
  </font>MaxY <font color="#000080">:= </font>GetDeviceCaps<font color="#000080">(</font>DC<font color="#000080">, </font>VertRes<font color="#000080">);
  </font>ReleaseDC<font color="#000080">(</font>HWindow<font color="#000080">, </font>DC<font color="#000080">);
  </font>MidX <font color="#000080">:= </font>MaxX <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
  </font>MidY <font color="#000080">:= </font>MaxY <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumLines <font color="#FF0000"><b>do
    for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
    begin
      </b></font>PosX<font color="#000080">[</font>i<font color="#000080">,</font>j<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>PosY<font color="#000080">[</font>i<font color="#000080">,</font>j<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>VelX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := -</font><font color="#800000">20 </font><font color="#000080">+ </font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font>VelY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := -</font><font color="#800000">20 </font><font color="#000080">+ </font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font>VelX<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := -</font><font color="#800000">20 </font><font color="#000080">+ </font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font>VelY<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := -</font><font color="#800000">20 </font><font color="#000080">+ </font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TSaveWindow<font color="#000080">.</font>SetupWindow<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TScrnSavWindow<font color="#000080">.</font>SetupWindow<font color="#000080">;
  </font>SetTimer<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_Timer<font color="#000080">, </font>TimerInterval<font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Perform our little animation }
</i></font><font color="#FF0000"><b>procedure </b></font>TSaveWindow<font color="#000080">.</font>wmTimer<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>DC<font color="#000080">: </font>HDC<font color="#000080">;
  </font>i<font color="#000080">, </font>j<font color="#000080">: </font>Integer<font color="#000080">;
  </font>ox1<font color="#000080">, </font>ox2<font color="#000080">, </font>oy1<font color="#000080">, </font>oy2<font color="#000080">: </font>Integer<font color="#000080">;
  </font>Pen<font color="#000080">: </font>HPen<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ox1 <font color="#000080">:= </font>PosX<font color="#000080">[</font>NumLines<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">];
  </font>oy1 <font color="#000080">:= </font>PosY<font color="#000080">[</font>NumLines<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">];
  </font>ox2 <font color="#000080">:= </font>PosX<font color="#000080">[</font>NumLines<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">];
  </font>oy2 <font color="#000080">:= </font>PosY<font color="#000080">[</font>NumLines<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">];
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>NumLines <font color="#FF0000"><b>downto </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
    for </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
    begin
      </b></font>PosX<font color="#000080">[</font>i<font color="#000080">,</font>j<font color="#000080">] := </font>PosX<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>j<font color="#000080">];
      </font>PosY<font color="#000080">[</font>i<font color="#000080">,</font>j<font color="#000080">] := </font>PosY<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>j<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
  begin
    </b></font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] := </font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] + </font>VelX<font color="#000080">[</font>i<font color="#000080">];
    </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] := </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] + </font>VelY<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] &lt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] &gt;= </font>MaxX<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>VelX<font color="#000080">[</font>i<font color="#000080">] := -</font>VelX<font color="#000080">[</font>i<font color="#000080">];
      </font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] := </font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] + </font>VelX<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] &lt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] &gt;= </font>MaxY<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>VelY<font color="#000080">[</font>i<font color="#000080">] := -</font>VelY<font color="#000080">[</font>i<font color="#000080">];
      </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] := </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">] + </font>VelY<font color="#000080">[</font>i<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DC <font color="#000080">:= </font>GetDC<font color="#000080">(</font>HWindow<font color="#000080">);
  </font>Pen <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>CreatePen<font color="#000080">(</font>ps_Solid<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Black_Brush<font color="#000080">));
  </font>MoveTo<font color="#000080">(</font>DC<font color="#000080">, </font>ox1<font color="#000080">, </font>oy1<font color="#000080">);
  </font>LineTo<font color="#000080">(</font>DC<font color="#000080">, </font>ox2<font color="#000080">, </font>oy2<font color="#000080">);                  </font><font color="#008000"><i>{ Erase line. }
  </i></font>DeleteObject<font color="#000080">(</font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>Pen<font color="#000080">));
  </font>Pen <font color="#000080">:= </font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>CreatePen<font color="#000080">(</font>ps_Solid<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>color<font color="#000080">));
  </font>MoveTo<font color="#000080">(</font>DC<font color="#000080">, </font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">], </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]);
  </font>LineTo<font color="#000080">(</font>DC<font color="#000080">, </font>PosX<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">], </font>PosY<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]);      </font><font color="#008000"><i>{ Draw new line. }
  </i></font>DeleteObject<font color="#000080">(</font>SelectObject<font color="#000080">(</font>DC<font color="#000080">, </font>Pen<font color="#000080">));
  </font>ReleaseDC<font color="#000080">(</font>HWindow<font color="#000080">, </font>DC<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TSaveWindow<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>KillTimer<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_Timer<font color="#000080">);
  </font>TScrnSavWindow<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var
  </b></font>TSApp<font color="#000080">: </font>TSaveApplication<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>TSApp<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">'Saver'</font><font color="#000080">);
  </font>TSApp<font color="#000080">.</font>Run<font color="#000080">;
  </font>TSApp<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

-----</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;-----

</font><font color="#FF0000"><b>Unit </b></font>Saver<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>WinProcs<font color="#000080">, </font>WinTypes<font color="#000080">, </font>wObjects<font color="#000080">, </font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>sc_ScreenSave <font color="#000080">= </font><font color="#800000">$F140</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TPasswordString <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

  </font>PConfigDialog <font color="#000080">= </font>PWindowsObject<font color="#000080">;

  </font>PPasswordDialog <font color="#000080">= ^</font>TPasswordDialog<font color="#000080">;
  </font>TPasswordDialog <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TDlgWindow<font color="#000080">)
    </font><font color="#FF0000"><b>procedure </b></font>SetupWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Cancel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>id_Cancel<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
      </font><font color="#FF0000"><b>virtual </b></font>id_First <font color="#000080">+ </font>id_Ok<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PScrnSavWindow <font color="#000080">= ^</font>TScrnSavWindow<font color="#000080">;
  </font>TScrnSavWindow <font color="#000080">= </font><font color="#FF0000"><b>Object</b></font><font color="#000080">(</font>TWindow<font color="#000080">)
    </font>CancelPressed<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>PWProtected<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Password<font color="#000080">: </font>TPasswordString<font color="#000080">;
    </font>EmptyCursor<font color="#000080">: </font>HCursor<font color="#000080">;
    </font>First<font color="#000080">: </font>Boolean<font color="#000080">;
    </font>prevPt<font color="#000080">: </font>TPoint<font color="#000080">;
    </font>PCfgDialog<font color="#000080">: </font>PConfigDialog<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>aParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">: </font>PChar<font color="#000080">);
    </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>HasMoved<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
    </font><font color="#FF0000"><b>function </b></font>GetClassName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>aWndClass<font color="#000080">: </font>TWndClass<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>SetupWindow<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>DefWndProc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>wmSyscommand<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">); </font><font color="#FF0000"><b>virtual </b></font>wm_SysCommand<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>PWEncode<font color="#000080">(</font>PWStr<font color="#000080">: </font>PChar<font color="#000080">);

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{ Encode a windows 3.x screen saver password string. }
</i></font><font color="#FF0000"><b>procedure </b></font>PWEncode<font color="#000080">(</font>PWStr<font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>iStrLen<font color="#000080">, </font>iStrPos<font color="#000080">: </font>Integer<font color="#000080">;
  </font>theByte<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>XORProc<font color="#000080">(</font>byte1<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>byte2<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>byte1 <font color="#000080">:= </font>byte1 <font color="#FF0000"><b>xor </b></font>byte2<font color="#000080">;
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">((</font>byte1 <font color="#000080">&lt;= </font><font color="#800000">$20</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>byte1 <font color="#000080">&gt;= </font><font color="#800000">$7F</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>byte1 <font color="#000080">&lt;= </font><font color="#800000">$90</font><font color="#000080">)) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">((</font>byte1 <font color="#000080">&gt;= </font><font color="#800000">$93</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>byte1 <font color="#000080">&lt;= </font><font color="#800000">$9F</font><font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>byte1 <font color="#000080">= </font><font color="#800000">$3D</font><font color="#000080">) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">(</font>byte1 <font color="#000080">= </font><font color="#800000">$5B</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>byte1 <font color="#000080">= </font><font color="#800000">$5D</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>byte2 <font color="#000080">:= </font>byte1<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>iStrLen <font color="#000080">:= </font>Strlen<font color="#000080">(</font>PWStr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>iStrLen <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

  </font>AnsiUpper<font color="#000080">(</font>PWStr<font color="#000080">);

  </font><font color="#008000"><i>{ Encode forwards }
  </i></font><font color="#FF0000"><b>for </b></font>iStrPos <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>iStrLen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
  begin
    </b></font>TheByte <font color="#000080">:= </font>Byte<font color="#000080">(</font>PWStr<font color="#000080">[</font>iStrPos<font color="#000080">]);
    </font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>iStrLen<font color="#000080">), </font>theByte<font color="#000080">);            </font><font color="#008000"><i>{ XOR byte with str len }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>iStrPos <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>XORProc<font color="#000080">(</font><font color="#800000">$2A</font><font color="#000080">, </font>theByte<font color="#000080">)          </font><font color="#008000"><i>{ if pos is first, XOR w/ constant }
    </i></font><font color="#FF0000"><b>else
    begin
      </b></font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>iStrPos<font color="#000080">), </font>theByte<font color="#000080">);          </font><font color="#008000"><i>{ else, XOR w/ position }
      </i></font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>PWStr<font color="#000080">[</font>iStrPos <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">]), </font>theByte<font color="#000080">);    </font><font color="#008000"><i>{ XOR w/ prev char }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PWStr<font color="#000080">[</font>iStrPos<font color="#000080">] := </font>Char<font color="#000080">(</font>theByte<font color="#000080">);         </font><font color="#008000"><i>{ store byte back into str }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Encode backwards }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>iStrLen <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
    for </b></font>iStrPos <font color="#000080">:= </font>iStrLen<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
    begin
      </b></font>theByte <font color="#000080">:= </font>Byte<font color="#000080">(</font>PWStr<font color="#000080">[</font>iStrPos<font color="#000080">]);          </font><font color="#008000"><i>{ XOR byte with str len }
      </i></font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>iStrLen<font color="#000080">), </font>theByte<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>iStrPos <font color="#000080">= </font>iStrLen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>XORProc<font color="#000080">(</font><font color="#800000">$2A</font><font color="#000080">, </font>theByte<font color="#000080">)         </font><font color="#008000"><i>{ if pos is last, XOR w/ constant }
      </i></font><font color="#FF0000"><b>else
      begin
        </b></font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>iStrPos<font color="#000080">), </font>theByte<font color="#000080">);        </font><font color="#008000"><i>{ else, XOR w/ position }
        </i></font>XORProc<font color="#000080">(</font>Byte<font color="#000080">(</font>PWStr<font color="#000080">[</font>iStrPos<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]), </font>theByte<font color="#000080">);    </font><font color="#008000"><i>{ XOR w/ next char }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>PWStr<font color="#000080">[</font>iStrPos<font color="#000080">] := </font>Char<font color="#000080">(</font>theByte<font color="#000080">);       </font><font color="#008000"><i>{ store byte back into str }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ --------TPasswordDialog methods------------------ }
</i></font><font color="#FF0000"><b>procedure </b></font>TPasswordDialog<font color="#000080">.</font>SetupWindow<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>MyRect<font color="#000080">: </font>TRect<font color="#000080">;
  </font>x<font color="#000080">, </font>y<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TDlgWindow<font color="#000080">.</font>SetupWindow<font color="#000080">;
  </font><font color="#008000"><i>{ Make sure Password Dialog Window is centered on the screen. }
  </i></font>x <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>sm_CXScreen<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
  </font>y <font color="#000080">:= </font>GetSystemMetrics<font color="#000080">(</font>sm_CYScreen<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
  </font>GetWindowRect<font color="#000080">(</font>HWindow<font color="#000080">, </font>MyRect<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>MyRect <font color="#FF0000"><b>do
    </b></font>SetWindowPos<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>x <font color="#000080">- ((</font>Right<font color="#000080">-</font>Left<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">), </font>y <font color="#000080">- ((</font>Bottom<font color="#000080">-</font>Top<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">),
                 </font>Right<font color="#000080">, </font>Bottom<font color="#000080">, </font>swp_NoSize <font color="#FF0000"><b>or </b></font>swp_NoZOrder<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TPasswordDialog<font color="#000080">.</font>Cancel<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TDialog<font color="#000080">.</font>Cancel<font color="#000080">(</font>Msg<font color="#000080">);
  </font>PScrnSavWindow<font color="#000080">(</font>Parent<font color="#000080">)^.</font>CancelPressed <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TPasswordDialog<font color="#000080">.</font>Ok<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>id_InputBox <font color="#000080">= </font><font color="#800000">107</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>NoErrors<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>PWStr<font color="#000080">: </font>TPasswordString<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>NoErrors <font color="#000080">:= </font>True<font color="#000080">;
  </font>GetDlgItemText<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_InputBox<font color="#000080">, </font>PWStr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>PWStr<font color="#000080">));
  </font>PWEncode<font color="#000080">(</font>PWStr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>PScrnSavWindow<font color="#000080">(</font>Parent<font color="#000080">)^.</font>PassWord<font color="#000080">, </font>PWStr<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>MessageBox<font color="#000080">(</font>HWindow<font color="#000080">, </font><font color="#800000">'The password is not correct.' </font><font color="#000080">+ </font><font color="#800000">#13 </font><font color="#000080">+
               </font><font color="#800000">'Please check your screen saver password and try again.'</font><font color="#000080">,
               </font><font color="#800000">'Screen Saver'</font><font color="#000080">, </font>mb_Ok <font color="#FF0000"><b>or </b></font>mb_IconStop<font color="#000080">);
    </font>SetFocus<font color="#000080">(</font>GetDlgItem<font color="#000080">(</font>HWindow<font color="#000080">, </font>id_InputBox<font color="#000080">));
    </font>NoErrors <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>NoErrors <font color="#FF0000"><b>then </b></font>TDlgWindow<font color="#000080">.</font>Ok<font color="#000080">(</font>Msg<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ --------TScrnSavWindow methods------------------ }
</i></font><font color="#FF0000"><b>constructor </b></font>TScrnSavWindow<font color="#000080">.</font>Init<font color="#000080">(</font>aParent<font color="#000080">: </font>PWindowsObject<font color="#000080">; </font>aTitle<font color="#000080">: </font>PChar<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TWindow<font color="#000080">.</font>Init<font color="#000080">(</font>aParent<font color="#000080">, </font>aTitle<font color="#000080">);
  </font>PWProtected <font color="#000080">:= </font>False<font color="#000080">;     </font><font color="#008000"><i>{ For programs which use this unit, but don't }
  </i></font>StrCopy<font color="#000080">(</font>Password<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);    </font><font color="#008000"><i>{ support passwords. }
  </i></font>First <font color="#000080">:= </font>True<font color="#000080">;
  </font>ShowCursor<font color="#000080">(</font>False<font color="#000080">);
  </font><font color="#008000"><i>{ It is also necessary to set the cursor to an empty rectangle, because
    some windows drivers don't support ShowCursor. }
  </i></font>EmptyCursor <font color="#000080">:= </font>LoadCursor<font color="#000080">(</font>HInstance<font color="#000080">, </font><font color="#800000">'EMPTY'</font><font color="#000080">);
  </font>Attr<font color="#000080">.</font>ExStyle <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;          </font><font color="#008000"><i>{ Screensave 'window' always on top. }
  </i></font>Attr<font color="#000080">.</font>Style  <font color="#000080">:= </font>ws_Popup<font color="#000080">;
  </font>SetCapture<font color="#000080">(</font>HWindow<font color="#000080">);          </font><font color="#008000"><i>{ Get all mouse messages. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TScrnSavWindow<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ReleaseCapture<font color="#000080">;
  </font>TWindow<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TScrnSavWindow<font color="#000080">.</font>GetClassName<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetClassName <font color="#000080">:= </font><font color="#800000">'ScreenSaverClass'</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TScrnSavWindow<font color="#000080">.</font>GetWindowClass<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>aWndClass<font color="#000080">: </font>TWndClass<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TWindow<font color="#000080">.</font>GetWindowClass<font color="#000080">(</font>aWndClass<font color="#000080">);
  </font>aWndClass<font color="#000080">.</font>hIcon <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>aWndClass<font color="#000080">.</font>Style <font color="#000080">:= </font>cs_SaveBits<font color="#000080">;
  </font>AWndClass<font color="#000080">.</font>HCursor <font color="#000080">:= </font>EmptyCursor<font color="#000080">;
  </font>aWndClass<font color="#000080">.</font>hbrBackground <font color="#000080">:= </font>GetStockObject<font color="#000080">(</font>Black_Brush<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TScrnSavWindow<font color="#000080">.</font>SetupWindow<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>rc<font color="#000080">: </font>TRect<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TWindow<font color="#000080">.</font>SetupWindow<font color="#000080">;
  </font>GetCursorPos<font color="#000080">(</font>PrevPt<font color="#000080">);
  </font>GetWindowRect<font color="#000080">(</font>GetDesktopWindow<font color="#000080">, </font>rc<font color="#000080">);
  </font>MoveWindow<font color="#000080">(</font>hWindow<font color="#000080">, </font>rc<font color="#000080">.</font>Left<font color="#000080">, </font>rc<font color="#000080">.</font>Top<font color="#000080">, </font>rc<font color="#000080">.</font>Right<font color="#000080">, </font>rc<font color="#000080">.</font>Bottom<font color="#000080">, </font>True<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TScrnSavWindow<font color="#000080">.</font>HasMoved<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>CancelPressed <font color="#000080">:= </font>False<font color="#000080">;
  </font>ShowCursor<font color="#000080">(</font>True<font color="#000080">);
  </font>SetCursor<font color="#000080">(</font>LoadCursor<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>idc_Arrow<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>PWProtected <font color="#FF0000"><b>then
    </b></font>Application<font color="#000080">^.</font>ExecDialog<font color="#000080">(</font>new<font color="#000080">(</font>PPasswordDialog<font color="#000080">, </font>Init<font color="#000080">(@</font>Self<font color="#000080">, </font><font color="#800000">'TYPEPWD'</font><font color="#000080">)));
  </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>CancelPressed<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>PostMessage<font color="#000080">(</font>HWindow<font color="#000080">, </font>wm_Close<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>First <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TScrnSavWindow<font color="#000080">.</font>DefWndProc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  case </b></font>msg<font color="#000080">.</font><font color="#FF0000"><b>Message of
    </b></font>wm_MouseMove<font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>MakePoint<font color="#000080">(</font>msg<font color="#000080">.</font>LParam<font color="#000080">).</font>x <font color="#000080">&lt;&gt; </font>prevPt<font color="#000080">.</font>x<font color="#000080">) </font><font color="#FF0000"><b>or
         </b></font><font color="#000080">(</font>MakePoint<font color="#000080">(</font>msg<font color="#000080">.</font>LParam<font color="#000080">).</font>y <font color="#000080">&lt;&gt; </font>prevPt<font color="#000080">.</font>y<font color="#000080">) </font><font color="#FF0000"><b>then
        if Not</b></font><font color="#000080">(</font>First<font color="#000080">) </font><font color="#FF0000"><b>then       </b></font><font color="#008000"><i>{ Do not exit on first mouse move. }
          </i></font>HasMoved<font color="#000080">(</font>Msg<font color="#000080">)
        </font><font color="#FF0000"><b>else
          </b></font>First <font color="#000080">:= </font>False<font color="#000080">;
    </font>wm_Activate<font color="#000080">,
    </font>wm_ActivateApp<font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>msg<font color="#000080">.</font>WParam <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>TWindow<font color="#000080">.</font>DefWndProc<font color="#000080">(</font>Msg<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>wm_KeyDown<font color="#000080">,
    </font>wm_SyskeyDown<font color="#000080">,
    </font>wm_LButtonDown<font color="#000080">,
    </font>wm_MButtonDown<font color="#000080">,
    </font>wm_RButtonDown<font color="#000080">: </font>HasMoved<font color="#000080">(</font>Msg<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TWindow<font color="#000080">.</font>DefWndProc<font color="#000080">(</font>Msg<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TScrnSavWindow<font color="#000080">.</font>wmSyscommand<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Msg<font color="#000080">: </font>TMessage<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">((</font>Msg<font color="#000080">.</font>WParam <font color="#FF0000"><b>and </b></font><font color="#800000">$FFF0</font><font color="#000080">) = </font>sc_ScreenSave<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Msg<font color="#000080">.</font>Result <font color="#000080">:= </font><font color="#800000">1
  </font><font color="#FF0000"><b>else
    </b></font>DefWndProc<font color="#000080">(</font>Msg<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

-----</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;---------</font><font color="#800000">8</font><font color="#000080">&lt;-----

ENCODED LINEPLAY.RES FILE REMOVED.  PLEASE <A HREF="0080.LINEPLAY.ZIP">DOWNLOAD</A> EITHER THE 
ATTACHMENT OR THE COMPLETE ZIP FILE.</I>

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to WIN-OS2 SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0080.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0080.LINEPLAY.ZIP">Attachment</a><b>]</b>
</p></body>
</html>
