<html>
<head><title> "PosIn()" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center">
<b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0088.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0088.POSIN.ZIP">Attachment</a><b>]</b>

</p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Here's a routine that's faster than Pos on my system. It's written
 in external assembly language, and linked directly into TP program
 code.  I'm including an example of using the code, the assembly
 source code, and a pre-assembled ready-to-compile POSIN.OBJ file:

 Here's the example... }

(*******************************************************************)
</i></font><font color="#FF0000"><b>PROGRAM </b></font>Demo<font color="#000080">; </font><font color="#008000"><i>{ A faster Pos() for TP4+. June 17/94 Greg Vigneault  }

</i></font><font color="#FF0000"><b>VAR </b></font>str <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;  </font>j <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>PosIn <font color="#000080">(</font>Pattern<font color="#000080">, </font>Str <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>EXTERNAL</b></font><font color="#000080">;
</font><font color="#008000"><i>{$L POSIN.OBJ}    (* link in the external code *)

</i></font><font color="#FF0000"><b>BEGIN
      </b></font>WriteLn<font color="#000080">;
      </font>str <font color="#000080">:= </font><font color="#800000">'Position of THIS in string is '</font><font color="#000080">;
      </font>j <font color="#000080">:= </font>PosIn <font color="#000080">(</font><font color="#800000">'THIS'</font><font color="#000080">,</font>str<font color="#000080">);;  </font>WriteLn <font color="#000080">(</font>str<font color="#000080">,</font>j<font color="#000080">);
      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>j <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>DO BEGIN </b></font>Write <font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">); </font>DEC<font color="#000080">(</font>j<font color="#000080">); </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>WriteLn <font color="#000080">(</font><font color="#800000">'^^^^'</font><font color="#000080">);
      </font>WriteLn<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font><font color="#008000"><i>(*******************************************************************)

</i></font>Here<font color="#800000">'s the assembly code source...
</font><font color="#000080">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
</font>code    segment byte <font color="#FF0000"><b>public </b></font><font color="#800000">'CODE'
        </font>assume  cs<font color="#000080">:</font>code
<font color="#000080">; </font><font color="#FF0000"><b>FUNCTION </b></font>PosIn <font color="#000080">(</font>pattern<font color="#000080">, </font><font color="#FF0000"><b>string </b></font><font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BYTE<font color="#000080">;
</font>pattern equ dword ptr <font color="#800000">8</font><font color="#000080">[</font>bp<font color="#000080">]
</font><font color="#FF0000"><b>string  </b></font>equ dword ptr <font color="#800000">4</font><font color="#000080">[</font>bp<font color="#000080">]
</font>PosIn   proc    <font color="#FF0000"><b>near
        public  </b></font>PosIn
        push  bp                    <font color="#000080">; </font>preserve
        mov   bp<font color="#000080">, </font>sp
        push  ds
        push  es
        cld                         <font color="#000080">; </font>assure <font color="#FF0000"><b>forward </b></font>scans
        lds   si<font color="#000080">, </font>pattern           <font color="#000080">; </font>DS<font color="#000080">:</font>SI <font color="#000080">-&gt; </font>pattern
        sub   ax<font color="#000080">, </font>ax                <font color="#000080">; </font>zero
        lodsb                       <font color="#000080">; </font>get length byte
        test  ax<font color="#000080">, </font>ax                <font color="#000080">; </font>null <font color="#FF0000"><b>string</b></font><font color="#000080">?
        </font>jz    done                  <font color="#000080">; </font>yes<font color="#000080">: </font>exit <font color="#FF0000"><b>with </b></font>zero
        mov   dx<font color="#000080">, </font>ax                <font color="#000080">; </font>length <font color="#FF0000"><b>of </b></font>pattern
        les   di<font color="#000080">, </font><font color="#FF0000"><b>string            </b></font><font color="#000080">; </font>ES<font color="#000080">:</font>DI <font color="#000080">-&gt; </font><font color="#FF0000"><b>string
        </b></font>sub   bx<font color="#000080">, </font>bx                <font color="#000080">; </font>zero
        mov   bl<font color="#000080">, </font>es<font color="#000080">:[</font>di<font color="#000080">]           ; </font><font color="#FF0000"><b>string </b></font>length
        cmp   bx<font color="#000080">, </font>dx                <font color="#000080">; </font>pattern <font color="#000080">&gt; </font><font color="#FF0000"><b>string </b></font><font color="#000080">?
        </font>jc    none                  <font color="#000080">; </font>yes<font color="#000080">: </font>exit <font color="#FF0000"><b>with </b></font>zero
        inc   di                    <font color="#000080">; </font>point <font color="#FF0000"><b>to </b></font><font color="#800000">1</font>st <font color="#FF0000"><b>string </b></font>char
        lodsb                       <font color="#000080">; </font>get pattern <font color="#800000">1</font>st char
        dec   dx                    <font color="#000080">; </font>adjust pointer
        sub   bx<font color="#000080">, </font>dx                <font color="#000080">; </font>don<font color="#800000">'t need to check end
  </font>po0<font color="#000080">:  </font>mov   cx<font color="#000080">, </font>bx                <font color="#000080">; </font>unsearched chars count
        repne scasb                 <font color="#000080">; </font>search <font color="#FF0000"><b>for </b></font>pattern char
        jne   none                  <font color="#000080">; </font>no char match
        mov   bx<font color="#000080">, </font>cx                <font color="#000080">; </font>unsearched count
        push  di                    <font color="#000080">; </font>save text pointers
        push  si
        mov   cx<font color="#000080">, </font>dx                <font color="#000080">; </font>length <font color="#FF0000"><b>of </b></font>pattern
        repe  cmpsb                 <font color="#000080">; </font>check <font color="#FF0000"><b>for </b></font>pattern
        pop   si                    <font color="#000080">; </font>restore pointers
        pop   di
        jne   po0                   <font color="#000080">; </font>loop <font color="#FF0000"><b>if </b></font>no pattern match
        lds   ax<font color="#000080">, </font><font color="#FF0000"><b>string            </b></font><font color="#000080">; </font><font color="#FF0000"><b>string </b></font>pointer
        xchg  ax<font color="#000080">, </font>di                <font color="#000080">; </font>swap offsets
        sub   ax<font color="#000080">, </font>di                <font color="#000080">; </font>subtract offsets
        dec   ax                    <font color="#000080">; </font>adjust <font color="#FF0000"><b>for </b></font>PosIn
        jmp   short done            <font color="#000080">; </font>found pattern
  none<font color="#000080">: </font>sub   ax<font color="#000080">, </font>ax                <font color="#000080">; </font>pattern <font color="#FF0000"><b>not </b></font>found
  done<font color="#000080">: </font>pop   es                    <font color="#000080">; </font>restore
        pop   ds
        mov   sp<font color="#000080">, </font>bp
        pop   bp
        ret   <font color="#800000">8
</font>PosIn   endp
code    ends
        <font color="#FF0000"><b>end
</b></font><font color="#000080">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

</font>{------------------------- snip, snip ----------------------------}

ENCODED POSIN.OBJ FILE REMOVED.  PLEASE <A HREF="0088.POSIN.ZIP">DOWNLOAD</A> EITHER THE 
ATTACHMENT OR THE COMPLETE ZIP FILE.
</I>
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to STRINGS SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0088.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0088.POSIN.ZIP">Attachment</a><b>]</b>
</p></body>
</html>
