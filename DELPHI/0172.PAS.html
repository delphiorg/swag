<html>
<head><title> "Interface into the wizunzip dll" by MICHAEL SLACK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center">
<b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0172.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0172.TESTDLL.ZIP">Attachment</a><b>]</b>

</p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ SEE BELOW FOR ENTIRE PROJECT USING THIS INTERFACE }
(* DLL can be found at: http://quest.jpl.nasa.gov/Info-ZIP/             *)

</i></font><font color="#FF0000"><b>UNIT </b></font>WizUnZip<font color="#000080">;

</font><font color="#008000"><i>(*                                                                      *)
(* AUTHOR: Michael G. Slack                    DATE WRITTEN: 05/17/1996 *)
(* ENVIRONMENT: Borland Pascal V7.0+/Delphi V1.02+                      *)
(*                                                                      *)
(* Unit that defines the interface into the wizunzip dll.               *)
(* NOTE: File names are case-sensitive.                                 *)
(*                                                                      *)
(* To use:                                                              *)
(*  VAR _DCL  : PDCL;                                                   *)
(*      Fils  : PACHAR; {pointer to array or pchars}                    *)
(*      ZipFn : ARRAY[0..144] OF CHAR;                                  *)
(*      FilNm : ARRAY[0..xx] OF CHAR;                                   *)
(*    { TT    : THANDLE; }                                              *)
(*       ...                                                            *)
(*  StrCopy(FilNm,'case sensitive file name (could incl wildcards)');   *)
(*  GetMem(Fils,SizeOf(PCHAR)); {only allocating for single file}       *)
(*   {or}                                                               *)
(*   {should use this method in Delphi - seems to prevent GPFs}         *)
(*   { TT := GlobalAlloc(GHnd,SizeOf(PCHAR)); }                         *)
(*   { Fils := GlobalLock(TT); }                                        *)
(*  Fils^[0] := @FilNm;                                                 *)
(*  StrCopy(ZipFn,'C:\UNZIP52.ZIP');                                    *)
(*  WZInitADCL(_DCL,HInstance,MWnd,LWnd); {create/initialize struct}    *)
(*  WITH _DCL^ DO                                                       *)
(*   BEGIN {setup rest of parameters for unzip}                         *)
(*    WITH lpUMB^ DO                                                    *)
(*     StrCopy(szUnzipToDirName,'some dir'); {only dir that is used}    *)
(*    {set flags wanted (all set to false from init)}                   *)
(*    OverWrite := TRUE; {example}                                      *)
(*    ArgC := 1; {set equal to number of files submitting}              *)
(*    lpszZipFN := @ZipFn;                                              *)
(*    FNV := Fils;                                                      *)
(*   END; {with}                                                        *)
(*  I := WZ_UnZip(_DCL); {run unzip proc}                               *)
(*  WZDestroyDCL(_DCL); {release control block}                         *)
(*  FreeMem(Fils,SizeOf(PCHAR)); {free file list}                       *)
(*   {or}                                                               *)
(*   { GlobalUnlock(TT); }                                              *)
(*   { GlobalFree(TT); }                                                *)
(*  IF I &lt;&gt; wze_OK THEN {problem with unzip};                           *)
(*                                                                      *)
(* -------------------------------------------------------------------- *)
(*                                                                      *)
(* REVISED: 07/30/1996 - Per suggestions from Brad Clarke               *)
(*                       (bclarke@cyberus.ca), added listing constants  *)
(*                       and changed nzFlag to integer.                 *)
(*                                                                      *)

</i></font><font color="#FF0000"><b>INTERFACE

 USES </b></font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>CommDlg<font color="#000080">;

 </font><font color="#FF0000"><b>CONST </b></font>LibName <font color="#000080">= </font><font color="#800000">'wizunz16'</font><font color="#000080">;
       </font>wzl_WizUnzip_Max_Path  <font color="#000080">= </font><font color="#800000">127</font><font color="#000080">; </font><font color="#008000"><i>{128}
       </i></font>wzl_Options_Buffer_Len <font color="#000080">= </font><font color="#800000">255</font><font color="#000080">; </font><font color="#008000"><i>{256}
       </i></font>wzl_None               <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{no listing}
       </i></font>wzl_Short              <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{short listing}
       </i></font>wzl_Long               <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{long listing}
       </i></font>wze_OK                 <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
       </font>wze_Warning            <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
       </font>wze_Err                <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
       </font>wze_BadErr             <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
       </font>wze_Mem                <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
       </font>wze_Mem2               <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
       </font>wze_Mem3               <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
       </font>wze_Mem4               <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
       </font>wze_Mem5               <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
       </font>wze_NoZip              <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;
       </font>wze_Param              <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
       </font>wze_Find               <font color="#000080">= </font><font color="#800000">11</font><font color="#000080">;
       </font>wze_Disk               <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">;
       </font>wze_EOF                <font color="#000080">= </font><font color="#800000">51</font><font color="#000080">;

 </font><font color="#FF0000"><b>TYPE </b></font>PUMB <font color="#000080">= ^</font>TUMB<font color="#000080">;
      </font>TUMB <font color="#000080">= </font><font color="#FF0000"><b>RECORD
              </b></font><font color="#008000"><i>{fully qualified archive name (OEM chars)}
              </i></font>szFileName          <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{directory with archive (ANSI chars)}
              </i></font>szDirName           <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{extraction directory &quot;unzip to&quot; (ANSI chars)}
              </i></font>szUnzipToDirName    <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{temp extraction dir &quot;unzip to&quot; (ANSI chars)}
              </i></font>szUnzipToDirNameTmp <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{extraction directory &quot;unzip from&quot; (ANSI chars)}
              </i></font>szUnzipFromDirName  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{text for totals of zip archive}
              </i></font>szTotalsLine        <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">79</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{scratch buffer}
              </i></font>szBuffer            <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_Options_Buffer_Len<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{wave file name for sound}
              </i></font>szSoundName         <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>wzl_WizUnzip_Max_Path<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{password for encrypted files}
              </i></font>szPassword          <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
              </font><font color="#008000"><i>{pointer to szpassword}
              </i></font>lpPassword          <font color="#000080">: </font>PCHAR<font color="#000080">;
              </font><font color="#008000"><i>{archive open file name struct (commdlg)}
              </i></font>ofn                 <font color="#000080">: </font>TOPENFILENAME<font color="#000080">;
              </font><font color="#008000"><i>{wave file open file name struct (commdlg)}
              </i></font>wofn                <font color="#000080">: </font>TOPENFILENAME<font color="#000080">;
              </font><font color="#008000"><i>{???}
              </i></font>msg                 <font color="#000080">: </font>TMSG<font color="#000080">;
              </font><font color="#008000"><i>{archive open file struct}
              </i></font>_of                 <font color="#000080">: </font>TOFSTRUCT<font color="#000080">;
              </font><font color="#008000"><i>{wave file open file struct}
              </i></font>wof                 <font color="#000080">: </font>TOFSTRUCT<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>TDLLPRNT <font color="#000080">= </font><font color="#FF0000"><b>FUNCTION</b></font><font color="#008000"><i>{(VAR F : FILE; Len : WORD; S : PCHAR)} </i></font><font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#008000"><i>{CEDCL;}
      </i></font>TDLLSND  <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE</b></font><font color="#000080">; </font><font color="#008000"><i>{CEDCL;}
      </i></font>PACHAR   <font color="#000080">= ^</font>TACHAR<font color="#000080">;
      </font>TACHAR   <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8187</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>PCHAR<font color="#000080">;
      </font>PDCL <font color="#000080">= ^</font>TDCL<font color="#000080">;
      </font>TDCL <font color="#000080">= </font><font color="#FF0000"><b>RECORD
              </b></font>PrintFunc         <font color="#000080">: </font>TDLLPRNT<font color="#000080">; </font><font color="#008000"><i>{ptr to appl print routine}
              </i></font>SoundProc         <font color="#000080">: </font>TDLLSND<font color="#000080">;  </font><font color="#008000"><i>{prt to appl sound routine}
              </i></font>StdOut            <font color="#000080">: </font>POINTER<font color="#000080">;  </font><font color="#008000"><i>{stdout/ptr to C FILE struct}
              </i></font>lpUMB             <font color="#000080">: </font>PUMB<font color="#000080">;
              </font>hWndList          <font color="#000080">: </font>HWND<font color="#000080">;     </font><font color="#008000"><i>{list box to disp zip contents in}
              </i></font>hWndMain          <font color="#000080">: </font>HWND<font color="#000080">;     </font><font color="#008000"><i>{appl main window}
              </i></font>hInst             <font color="#000080">: </font>THANDLE<font color="#000080">;  </font><font color="#008000"><i>{appl instance}
              </i></font>ExtractOnlyNewer  <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = extract only newer}
              </i></font>OverWrite         <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = always overwrite}
              </i></font>SpaceToUnderscore <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = convert space to underscore}
              </i></font>PromptToOverwrite <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = prompt on overwrite}
              </i></font>ncFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = write to stdout}
              </i></font>ntFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = test zip file}
              </i></font>nvFlag            <font color="#000080">: </font>INTEGER<font color="#000080">;  </font><font color="#008000"><i>{0=no list, 1=short list, 2=long list}
              </i></font>nuFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = update extraction}
              </i></font>nzFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = display zip file comment}
              </i></font>ndFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = extract w/stored directories}
              </i></font>noFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = extract all files}
              </i></font>naFlag            <font color="#000080">: </font>BOOL<font color="#000080">;     </font><font color="#008000"><i>{true = ascii-ebcdic/eoln translate}
              </i></font>ArgC              <font color="#000080">: </font>INTEGER<font color="#000080">;  </font><font color="#008000"><i>{count of files to extract}
              </i></font>lpszZipFN         <font color="#000080">: </font>PCHAR<font color="#000080">;    </font><font color="#008000"><i>{zip file name}
              </i></font>FNV               <font color="#000080">: </font>PACHAR<font color="#000080">;   </font><font color="#008000"><i>{list of files to extract}
             </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>(************************************************************************)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZInitADCL<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">; </font>PInst <font color="#000080">: </font>THANDLE<font color="#000080">; </font>MainW<font color="#000080">, </font>ListW <font color="#000080">: </font>HWND<font color="#000080">);
     </font><font color="#008000"><i>(* procedure used to alloc and init a dcl struct with zeros *)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZDestroyDCL<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">);
     </font><font color="#008000"><i>(* procedure used to free a dcl allocated by prior call to initadcl *)

 </i></font><font color="#FF0000"><b>FUNCTION  </b></font>WZDummyPrint<font color="#008000"><i>{(VAR FH : INTEGER; Len : WORD; S : PCHAR)} </i></font><font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#008000"><i>{CEDCL;}
     (* procedure that can be used as a dummy print routine for dll *)
     (* - C call back, parameters ignored in dummy                  *)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZDummySound<font color="#000080">; </font><font color="#008000"><i>{CEDCL;}
     (* procedure that can be used as a dummy sound routine for the dll *)

 </i></font><font color="#FF0000"><b>FUNCTION  </b></font>WZRetErrorString<font color="#000080">(</font>ErrC <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
     </font><font color="#008000"><i>(* function used to return error as a string *)

 </i></font><font color="#FF0000"><b>FUNCTION  </b></font>WZ_UnZip<font color="#000080">(</font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">) : </font>INTEGER<font color="#000080">;
     </font><font color="#008000"><i>(* wrapper function to handle switching to choosen unzip to directory *)

 (* dll functions ----------------------------------------------------- *)
 </i></font><font color="#FF0000"><b>FUNCTION  </b></font>DLLProcessZipFiles<font color="#000080">(</font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">) : </font>INTEGER<font color="#000080">;
     </font><font color="#008000"><i>(* function to run the unzip routine *)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetDLLVersion<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Ver <font color="#000080">: </font>LONGINT<font color="#000080">);
     </font><font color="#008000"><i>(* procedure to return the current dll version of wizunzip *)
     (*   hiword(ver) = major . loword(ver) = minor             *)

(************************************************************************)

</i></font><font color="#FF0000"><b>IMPLEMENTATION

</b></font><font color="#008000"><i>{$IFDEF VER80}
 </i></font><font color="#FF0000"><b>USES </b></font>SysUtils<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
 </i></font><font color="#FF0000"><b>USES </b></font>Strings<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

(************************************************************************)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZInitADCL<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">; </font>PInst <font color="#000080">: </font>THANDLE<font color="#000080">; </font>MainW<font color="#000080">, </font>ListW <font color="#000080">: </font>HWND<font color="#000080">);

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wzinitadcl*)
   </i></font>GetMem<font color="#000080">(</font>_DCL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TDCL<font color="#000080">));
   </font>FillChar<font color="#000080">(</font>_DCL<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>TDCL<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
   </font>_DCL<font color="#000080">^.</font>PrintFunc <font color="#000080">:= </font>WZDummyPrint<font color="#000080">;
   </font>_DCL<font color="#000080">^.</font>SoundProc <font color="#000080">:= </font>WZDummySound<font color="#000080">;
   </font>GetMem<font color="#000080">(</font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TUMB<font color="#000080">));
   </font>FillChar<font color="#000080">(</font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">^,</font>SizeOf<font color="#000080">(</font>TUMB<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
   </font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">^.</font>lpPassword <font color="#000080">:= @</font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">^.</font>szPassword<font color="#000080">;
   </font>_DCL<font color="#000080">^.</font>hWndMain <font color="#000080">:= </font>MainW<font color="#000080">;
   </font>_DCL<font color="#000080">^.</font>hWndList <font color="#000080">:= </font>ListW<font color="#000080">;
   </font>_DCL<font color="#000080">^.</font>hInst    <font color="#000080">:= </font>PInst<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wzinitadcl*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZDestroyDCL<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">);

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wzdestroydcl*)
   </i></font><font color="#FF0000"><b>IF </b></font>_DCL <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN </b></font>Exit<font color="#000080">;
   </font>FreeMem<font color="#000080">(</font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TUMB<font color="#000080">));
   </font>FreeMem<font color="#000080">(</font>_DCL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TDCL<font color="#000080">));
   </font>_DCL <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wzdestroydcl*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>WZDummyPrint<font color="#008000"><i>{(VAR F : FILE; Len : WORD; S : PCHAR)} </i></font><font color="#000080">: </font>WORD<font color="#000080">;
    </font><font color="#FF0000"><b>VAR </b></font>Len <font color="#000080">: </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wzdummyprint*)
   </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV AX,[BP+8] </font><font color="#008000"><i>{pass back len as return}
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wzdummyprint*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>WZDummySound<font color="#000080">;
    </font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wzdummysound*)
   {do nothing}
   </i></font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{so that optimizations do not remove proc}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wzdummysound*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>WZRetErrorString<font color="#000080">(</font>ErrC <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>VAR </b></font>T <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
        </font>N <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wzreterrorstring*)
   </i></font>T <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>CASE </b></font>ErrC <font color="#FF0000"><b>OF
    </b></font>wze_OK      <font color="#000080">: ;
    </font>wze_Warning <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Warning, zip may have error!'</font><font color="#000080">;
    </font>wze_Err     <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Error in zipfile!'</font><font color="#000080">;
    </font>wze_BadErr  <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Critical error in zipfile!'</font><font color="#000080">;
    </font>wze_Mem     <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Insufficient memory!'</font><font color="#000080">;
    </font>wze_Mem2    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Insufficient memory (2)!'</font><font color="#000080">;
    </font>wze_Mem3    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Insufficient memory (3)!'</font><font color="#000080">;
    </font>wze_Mem4    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Insufficient memory (4)!'</font><font color="#000080">;
    </font>wze_Mem5    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Insufficient memory (5)!'</font><font color="#000080">;
    </font>wze_NoZip   <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Not a zip file/zip file not found!'</font><font color="#000080">;
    </font>wze_Param   <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Invalid parameters specified!'</font><font color="#000080">;
    </font>wze_Find    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'No files found!'</font><font color="#000080">;
    </font>wze_Disk    <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Disk full error!'</font><font color="#000080">;
    </font>wze_EOF     <font color="#000080">: </font>T <font color="#000080">:= </font><font color="#800000">'Unexpected EOF encountered!'</font><font color="#000080">;
    </font><font color="#FF0000"><b>ELSE BEGIN </b></font><font color="#008000"><i>{other error}
          </i></font>Str<font color="#000080">(</font>ErrC<font color="#000080">,</font>N<font color="#000080">);
          </font>T <font color="#000080">:= </font><font color="#800000">'Other error during zip operation - Error code = '</font><font color="#000080">+</font>N<font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{else}
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
   </i></font>WZRetErrorString <font color="#000080">:= </font>T<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wzreterrorstring*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>WZ_UnZip<font color="#000080">(</font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">) : </font>INTEGER<font color="#000080">;
    </font><font color="#FF0000"><b>VAR </b></font>S1<font color="#000080">, </font>S2 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">144</font><font color="#000080">];
        </font>W      <font color="#000080">: </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*wz_unzip*)
   </i></font>W <font color="#000080">:= </font>SetErrorMode<font color="#000080">(</font><font color="#800000">$8001</font><font color="#000080">); </font>S1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>S1<font color="#000080">); </font>S2 <font color="#000080">:= </font>StrPas<font color="#000080">(</font>_DCL<font color="#000080">^.</font>lpUMB<font color="#000080">^.</font>szUnzipToDirName<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>S2<font color="#000080">[</font>Length<font color="#000080">(</font>S2<font color="#000080">)] = </font><font color="#800000">'\'
    </font><font color="#FF0000"><b>THEN BEGIN </b></font><font color="#008000"><i>{remove '\'?}
          </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>S2<font color="#000080">) &gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>S2<font color="#000080">[</font>Length<font color="#000080">(</font>S2<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">':'</font><font color="#000080">)
           </font><font color="#FF0000"><b>THEN </b></font>Delete<font color="#000080">(</font>S2<font color="#000080">,</font>Length<font color="#000080">(</font>S2<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{not 'c:\'}
          </i></font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>S2<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>S2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{then}
   </i></font><font color="#FF0000"><b>IF </b></font>S2 <font color="#000080">&lt;&gt; </font><font color="#800000">''
    </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>{$I-} </i></font>ChDir<font color="#000080">(</font>S2<font color="#000080">) </font><font color="#008000"><i>{$I+}
   </i></font><font color="#FF0000"><b>ELSE </b></font>S1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>THEN BEGIN </b></font><font color="#008000"><i>{error in ch dir}
          </i></font>MessageBeep<font color="#000080">(</font>mb_OK<font color="#000080">);
          </font>MessageBox<font color="#000080">(</font>_DCL<font color="#000080">^.</font>hWndMain<font color="#000080">,</font><font color="#800000">'Could not set &quot;unzip-to&quot; directory!'</font><font color="#000080">,</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">,
                     </font>mb_OK <font color="#FF0000"><b>OR </b></font>mb_IconStop<font color="#000080">);
          </font>S1 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{then}
   </i></font>SetErrorMode<font color="#000080">(</font>W<font color="#000080">);
   </font>WZ_UnZip <font color="#000080">:= </font>DLLProcessZipFiles<font color="#000080">(</font>_DCL<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>S1 <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>THEN </b></font>ChDir<font color="#000080">(</font>S1<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*wz_unzip*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>DLLProcessZipFiles<font color="#000080">(</font>_DCL <font color="#000080">: </font>PDCL<font color="#000080">) : </font>INTEGER<font color="#000080">;
  </font><font color="#FF0000"><b>EXTERNAL </b></font>LibName INDEX <font color="#800000">1</font><font color="#000080">;

 </font><font color="#FF0000"><b>PROCEDURE </b></font>GetDLLVersion<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Ver <font color="#000080">: </font>LONGINT<font color="#000080">);
  </font><font color="#FF0000"><b>EXTERNAL </b></font>LibName INDEX <font color="#800000">3</font><font color="#000080">;

</font><font color="#008000"><i>(************************************************************************)

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>(*of unit*)

{ { {------------------------- snip, snip ----------------------------}

ENCODED TESTDLL.ZIP FILE REMOVED.  PLEASE <A HREF="0172.TESTDLL.ZIP">DOWNLOAD</A> EITHER THE 
ATTACHMENT OR THE COMPLETE ZIP FILE.
</i>
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DELPHI SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0172.PAS">Original</a><b>]</b>&nbsp;&nbsp;
<b>[</b><a href="0172.TESTDLL.ZIP">Attachment</a><b>]</b>
</p></body>
</html>
